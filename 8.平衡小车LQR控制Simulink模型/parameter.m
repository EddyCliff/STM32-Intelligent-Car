clc
m = 0.035;
r = 0.0672;
I = 0.5*m*r^2;
M = 0.757-2*m;
l = 0.5*0.0903;
J_p = (1/12)*M*(0.0903^2+0.0530^2);
d = 0.1612;
J_delta = (1/12)*M*(0.0930^2+0.0530^2);
g = 9.8;
Q_eq = J_p*M+(J_p+M*l^2)*(2*m+2*I/r^2);
A_23 = -(M^2*l^2*g)/Q_eq;
A_43 = M*l*g*(M+2*m+2*I/r^2)/Q_eq;
B_21 = (J_p+M*l^2+M*l*r)/(Q_eq*r);
B_22 = B_21;
B_41 = -(M*l/r+M+2*m+2*I/r^2)/Q_eq;
B_42 = B_41;
B_61 = 1/(r*(m*d+I*d/r^2+2*J_delta/d));
B_62 = -B_61;
A = [0 1 0 0 0 0; 0 0 A_23 0 0 0; 0 0 0 1 0 0; 0 0 A_43 0 0 0; 0 0 0 0 0 1; 0 0 0 0 0 0];
B = (I/r)*[0 0; B_21 B_22; 0 0; B_41 B_42; 0 0; B_61 B_62];
Tc = ctrb(A,B);
if (rank(Tc)==6)
    fprintf('此系统是可控的！\n');
    Q = [1000 0 0 0 0 0; 0 0 0 0 0 0; 0 0 0 0 0 0; 0 0 0 1000 0 0; 0 0 0 0 1000 0; 0 0 0 0 0 0];
    R = [1 0; 0 1];
    K = lqr(A,B,Q,R);
end
